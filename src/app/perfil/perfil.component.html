<div class="min-h-screen bg-fondo flex flex-col relative">

  <main class="flex flex-1 relative">

    <img src="logo4-Photoroom.png" alt="Logo"
         class="absolute top-4 left-4 w-60 h-60 object-cover rounded-full shadow-lg transition-transform duration-500 hover:scale-110">

    <img src="/ojo.jpg" alt="Imagen decorativa"
         class="absolute top-4 right-4 w-56 md:w-64 lg:w-72 h-56 md:h-64 lg:h-72 object-cover rounded-lg shadow-lg transition-transform duration-500 hover:scale-110 cursor-pointer"
         [class.z-50]="imgTop"
         (click)="imgTop = false">

    <div class="flex justify-center items-center w-full pt-20 pb-10">

      <div class="bg-naranja w-11/12 max-w-[1000px] min-h-[85vh] rounded-2xl flex flex-col items-center py-10 px-6 shadow-xl">

        <h1 class="text-4xl md:text-5xl font-extrabold mb-10 text-black uppercase tracking-tighter text-center">
          Mi Perfil Artístico
        </h1>

        <div class="bg-black w-11/12 max-w-[900px] rounded-2xl p-10 text-white shadow-2xl">

          <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
            <div class="flex flex-col items-center justify-center">
              <img [src]="profileImage" class="w-64 h-64 object-cover rounded-xl border-4 border-[#81B29A] shadow-2xl">
              <input type="file" #fileInput class="hidden" (change)="onFileSelected($event)" accept="image/*" />
              <button class="text-[#81B29A] mt-4 hover:underline font-bold" (click)="triggerFileInput()">
                Cambiar Avatar
              </button>

              <div class="mt-8 bg-gray-900 border border-[#81B29A] rounded-2xl p-4 flex items-center space-x-4 w-full">
                <div class="bg-[#81B29A] p-2 rounded-full">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-black" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
                  </svg>
                </div>
                <div class="flex-1">
                  <p class="text-xs text-gray-400 font-bold uppercase">Puntaje Total</p>
                  <p class="text-3xl font-black text-[#81B29A]">{{ puntajeTotal }} <span class="text-xs text-white">PTS</span></p>
                  <div class="w-full bg-gray-700 h-1.5 rounded-full mt-1 overflow-hidden">
                    <div class="bg-[#81B29A] h-full transition-all duration-1000" [style.width.%]="barraProgreso"></div>
                  </div>
                </div>
              </div>
            </div>

            <div class="flex flex-col justify-center space-y-4">
              <div *ngFor="let campo of camposPerfil" class="flex flex-col">
                <span class="text-[#81B29A] font-bold text-sm uppercase tracking-widest">{{campo.label}}</span>

                <input *ngIf="editMode && usuario" [(ngModel)]="($any(usuario)[campo.key])"
                       class="bg-gray-800 border-b-2 border-[#81B29A] p-2 outline-none focus:bg-gray-700">

                <span *ngIf="!editMode" class="text-2xl font-light">
                  {{ usuario ? $any(usuario)[campo.key] : '---' }}
                </span>
              </div>

              <div class="flex flex-col">
                <span class="text-gray-500 font-bold text-sm uppercase">Email (Privado)</span>
                <span class="text-xl text-gray-400 italic">{{ usuario?.email }}</span>
              </div>
            </div>
          </div>

          <div class="mt-10 flex justify-center border-t border-gray-800 pt-6">
            <button *ngIf="!editMode" (click)="toggleEditMode()"
                    class="bg-[#81B29A] text-black px-8 py-3 rounded-full font-bold hover:scale-105 transition-transform">
              EDITAR PERFIL
            </button>
            <div *ngIf="editMode" class="flex gap-4">
              <button (click)="toggleEditMode()" class="px-6 py-2 border border-white rounded-full">Cancelar</button>
              <button (click)="guardarCambios()" [disabled]="loading" class="px-6 py-2 bg-green-600 rounded-full font-bold">
                {{ loading ? 'Guardando...' : 'Confirmar Cambios' }}
              </button>
            </div>
          </div>
        </div>

        <div class="bg-white w-11/12 max-w-[900px] mt-8 rounded-2xl p-8 shadow-xl">
          <h2 class="text-2xl font-black text-black mb-6 flex items-center">
            <span class="bg-black w-2 h-8 mr-3 rounded-full"></span>
            ÚLTIMOS TESTS COMPLETADOS
          </h2>

          <div *ngIf="historialPuntajes && historialPuntajes.length > 0; else noTests" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div *ngFor="let item of historialPuntajes"
                 class="flex justify-between items-center p-4 bg-gray-50 border-l-4 border-black rounded-r-xl hover:bg-gray-100 transition-colors">
              <div>
                <p class="font-bold text-lg text-black">{{ item.tituloTest || 'Test de Arte' }}</p>
                <p class="text-xs text-gray-500 uppercase font-semibold">Completado</p>
              </div>
              <div class="text-right">
                <span class="text-2xl font-black text-[#81B29A]">{{ item.puntaje }}</span>
                <span class="text-[10px] block text-gray-400 font-bold">PUNTOS</span>
              </div>
            </div>
          </div>

          <ng-template #noTests>
            <div class="text-center py-10">
              <p class="text-gray-400 italic text-lg font-medium">Aún no has realizado ningún test.</p>
              <button (click)="router.navigate(['/tests'])" class="mt-4 text-black font-black underline">Ir a tests</button>
            </div>
          </ng-template>
        </div>

        <button class="mt-8 text-black font-black text-2xl border-b-4 border-black hover:bg-black hover:text-white px-6 py-2 transition-all uppercase tracking-tighter"
                (click)="abrirModal('tests')">
          Historial Completo
        </button>
      </div>
    </div>

    <div class="fixed top-1/2 right-4 transform -translate-y-1/2 flex flex-col space-y-4 z-40">
      <button (click)="router.navigate(['/tests'])" class="bg-white text-black p-4 rounded-l-xl font-black shadow-lg hover:-translate-x-2 transition-transform border-y border-l border-black">IR A TESTS</button>
      <button (click)="router.navigate(['/inicio'])" class="bg-black text-white p-4 rounded-l-xl font-black shadow-lg hover:-translate-x-2 transition-transform">INICIO</button>
      <button (click)="cerrarSesion()" class="bg-red-600 text-white p-4 rounded-l-xl font-black shadow-lg hover:-translate-x-2 transition-transform">SALIR</button>
    </div>

  </main>
  <!-- FOOTER -->
  <footer class="bg-black py-8 relative">
    <div class="container mx-auto px-4 flex items-center justify-between">
      <div class="flex items-center space-x-6">
        <img src="/facebook.png" alt="Facebook" class="h-8 w-8 object-contain cursor-pointer">
        <img src="/instagram.png" alt="Instagram" class="h-8 w-8 object-contain cursor-pointer">
        <img src="/twitter.png" alt="Twitter" class="h-8 w-8 object-contain cursor-pointer">
      </div>
      <p class="text-white text-center flex-1">© 2025 Arteando. Todos los derechos reservados.</p>
      <div class="flex items-center space-x-4 text-white">
        <button (click)="abrirModal('legal')" class="hover:underline">Aviso Legal</button>
        <button (click)="abrirModal('privacidad')" class="hover:underline">Política de Privacidad</button>
      </div>
    </div>
  </footer>

  <!-- MODALES LEGALES -->
  <div *ngIf="modalActivo === 'legal'" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 transition-opacity duration-300">
    <div class="bg-black rounded-2xl shadow-2xl p-8 max-w-lg w-full text-center relative animate-fade-in">
      <button class="absolute top-3 right-4 text-gray-400 hover:text-gray-600 text-2xl font-bold" (click)="cerrarModal()">×</button>
      <img src="/aviso.gif" class="mx-auto mb-4 w-40 " alt="modal aviso" />
      <h2 class="text-2xl font-bold mb-2" style="color:#E07A5F;">Aviso Legal</h2>
      <p class="text-white leading-relaxed">
        Este sitio web, <strong>Arteando</strong>, es un espacio digital dedicado a la difusión artística.
        Toda la información, imágenes y recursos aquí publicados pertenecen a sus respectivos autores.
        El uso indebido, reproducción no autorizada o distribución de cualquier contenido está
        estrictamente prohibido según la legislación vigente.
        <br><br>
        Arteando no se hace responsable del uso que terceros hagan del material disponible en la
        plataforma. Al acceder a este sitio aceptas cumplir con estas condiciones legales.
      </p>
      <button (click)="cerrarModal()" class="mt-6 text-white px-6 py-2 rounded-lg transition"
              style="background-color:#E07A5F;" onmouseover="this.style.backgroundColor='#cc684f'"
              onmouseout="this.style.backgroundColor='#E07A5F'">Entendido</button>
    </div>
  </div>

  <div *ngIf="modalActivo === 'privacidad'" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 transition-opacity duration-300">
    <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-lg w-full text-center relative animate-fade-in">
      <button class="absolute top-3 right-4 text-gray-400 hover:text-gray-600 text-2xl font-bold" (click)="cerrarModal()">×</button>
      <img src="/modal.gif" class="mx-auto mb-4 w-40 " alt="modal privacidad" />
      <h2 class="text-2xl font-bold mb-2" style="color:#E07A5F;">Política de Privacidad</h2>
      <p class="text-gray-700 leading-relaxed">
        En <strong>Arteando</strong> respetamos tu privacidad. Los datos personales que ingreses en
        nuestra plataforma serán utilizados únicamente con fines de navegación, mejora de la experiencia
        y comunicación directa contigo cuando sea necesario.
        <br><br>
        No compartimos tu información con terceros y puedes solicitar en cualquier momento la
        modificación o eliminación de tus datos. Al utilizar Arteando, aceptas nuestra política de
        tratamiento responsable y seguro de la información.
      </p>
      <button (click)="cerrarModal()" class="mt-6 text-white px-6 py-2 rounded-lg transition"
              style="background-color:#E07A5F;" onmouseover="this.style.backgroundColor='#cc684f'"
              onmouseout="this.style.backgroundColor='#E07A5F'">Entendido</button>
    </div>
  </div>

</div>
